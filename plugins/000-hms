#!/usr/bin/env bash
set -euo pipefail

OUT="${WAYBAR_OUTPUT_NAME:-$(/usr/bin/seasoning which-output 2>/dev/null || echo default)}"
CACHE="${SEASONING_CACHE:-$HOME/.cache/seasoning}/$OUT"
MODE_FILE="$CACHE/mode.000-hms.state"
mkdir -p "$CACHE"

mode=0
[[ -f "$MODE_FILE" ]] && read -r mode < "$MODE_FILE" || true
[[ "$mode" =~ ^[0-9]+$ ]] || mode=0
mode=$(( mode % 4 ))     # <<< wrap here

case "$mode" in
  0) fmt='+%H:%M' ;;
  1) fmt='+%H·%M' ;;
  2) fmt='+%H:%M:%S' ;;
  3) fmt='+%H·%M·%S' ;;
esac

txt="$(date "$fmt")"
printf '{"text":"%s","class":"mid--000-hms"}\n' "$txt"
